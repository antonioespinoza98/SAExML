distrito %in% sarchi ~ 'Sarchí',
distrito %in% upala ~ 'Upala',
distrito %in% los_chiles ~ 'Los Chiles',
distrito %in% guatuso ~ 'Guatuso',
distrito %in% rio_cuarto ~ 'Río Cuarto',
distrito %in% cartago ~ 'Cartago',
distrito %in% paraiso ~ 'Paraíso',
distrito %in% la_union ~ 'La Unión',
distrito %in% jimenez ~ 'Jiménez',
distrito %in% turrialba ~ 'Turrialba',
distrito %in% alvarado ~ 'Alvarado',
distrito %in% oreamuno ~ 'Oreamuno',
distrito %in% el_guarco ~ 'El Guarco',
distrito %in% heredia ~ 'Heredia',
distrito %in% barva ~ 'Barva',
distrito %in% santo_domingo ~ 'Santo Domingo',
distrito %in% santa_barbara ~ 'Santa Bárbara',
distrito %in% san_rafael ~ 'San Rafael',
distrito %in% san_isidro ~ 'San Isidro',
distrito %in% belen ~ 'Belén',
distrito %in% flores ~ 'Flores',
distrito %in% san_pablo ~ 'San Pablo',
distrito %in% sarapiqui ~ 'Sarapiquí',
distrito %in% liberia ~ 'Liberia',
distrito %in% nicoya ~ 'Nicoya',
distrito %in% santa_cruz ~ 'Santa Cruz',
distrito %in% bagaces ~ 'Bagaces',
distrito %in% carrillo ~ 'Carrillo',
distrito %in% canas ~ 'Cañas',
distrito %in% abangares ~ 'Abangares',
distrito %in% tilaran ~ 'Tilarán',
distrito %in% nandayure ~ 'Nandayure',
distrito %in% la_cruz ~ 'La Cruz',
distrito %in% hojancha ~ 'Hojancha',
distrito %in% puntarenas ~ 'Puntarenas',
distrito %in% esparza ~ 'Esparza',
distrito %in% buenos_aires ~ 'Buenos Aires',
distrito %in% montes_de_oro ~ 'Montes de Oro',
distrito %in% osa ~ 'Osa',
distrito %in% quepos ~ 'Quepos',
distrito %in% golfito ~ 'Golfito',
distrito %in% coto_brus ~ 'Coto Brus',
distrito %in% parrita ~ 'Parrita',
distrito %in% corredores ~ 'Corredores',
distrito %in% garabito ~ 'Garabito',
distrito %in% monteverde ~ 'Monteverde',
distrito %in% puerto_jimenez ~ 'Puerto Jiménez',
distrito %in% limon ~ 'Limón',
distrito %in% pococi ~ 'Pococí',
distrito %in% siquirres ~ 'Siquirres',
distrito %in% talamanca ~ 'Talamanca',
distrito %in% matina ~ 'Matina',
distrito %in% guacimo ~ 'Guácimo'
)
)
# se lo agregamos al data frame del censo
censo_mrp$pred_ingreso <- pred
# Creamos una base de datos resumen para el ingreso medio para cada uno
# de los 81 cantones existentes en el censo 2011.
ingreso_cantonal <- censo_mrp %>%
group_by(canton) %>%
summarise(
ingreso_medio = mean(pred_ingreso)
)
saveRDS(ingreso_cantonal, "ingreso/output/ingreso_cantonal.rds")
# Creamos una columna nueva donde recodificamos el DAM y le llamamos
# código. Esto se hace debido a que para poder realizar el mapa
# se hace un left join con el shapefile, por lo tanto el nombre de la
#columna en común debe ser igual a la del otro archivo.
# para evitar recodings, se hace desde acá.
censo_mrp <- censo_mrp <- readRDS("ingreso/datos/cens0.rds") %>%
flilter(anoest != "98") %>%
mutate(
region = recode(dam,
"01" = "Central",
"02" = "Chorotega",
"03" = "Pacífico Central",
"04" = "Brunca",
"05" = "Huetar Caribe",
"06" = "Huetar Norte"))
# volvemos a cargar la predicción y se la agregamos a la base del censo
pred <- readRDS("ingreso/output/pred3.rds")
# Creamos una columna nueva donde recodificamos el DAM y le llamamos
# código. Esto se hace debido a que para poder realizar el mapa
# se hace un left join con el shapefile, por lo tanto el nombre de la
#columna en común debe ser igual a la del otro archivo.
# para evitar recodings, se hace desde acá.
censo_mrp <- censo_mrp <- readRDS("ingreso/datos/cens0.rds") %>%
filter(anoest != "98") %>%
mutate(
region = recode(dam,
"01" = "Central",
"02" = "Chorotega",
"03" = "Pacífico Central",
"04" = "Brunca",
"05" = "Huetar Caribe",
"06" = "Huetar Norte"))
censo_mrp$pred_ingreso <- pred
# Creamos una base de datos resumen para las regiones de planificación
ingreso_region <- censo_mrp %>%
group_by(region) %>%
summarise(
ingreso_medio = mean(pred_ingreso)
)
saveRDS(ingreso_region, "ingreso/output/ingreso_region.rds")
rm(list = ls())
cantones <- st_read("ingreso/output/cantones_ajustado_cr.geojson", quiet = TRUE)
ingreso_cantonal <- readRDS("ingreso/output/ingreso_cantonal.rds")
mapa <- left_join(
x = cantones,
y = ingreso_cantonal,
by = join_by(canton == canton)
)
glimpse(mapa)
mapa_plot <- ggplot(
data = mapa,
mapping = aes(
fill = ingreso_medio
)
) +
geom_sf(color = "white") +
labs(fill = "Ingreso medio") +
scale_fill_viridis_c() +
theme_minimal()
mapa_plot
rm(list = ls())
regiones <- st_read("ingreso/output/regiones_cr.geojson")
ingreso_region <- readRDS("ingreso/output/ingreso_region.rds")
mapping <- left_join(
x = regiones,
y = ingreso_region,
by = join_by(region == region)
)
region_plot <- ggplot(
data = mapping,
mapping = aes(
fill = ingreso_medio
)
) +
geom_sf(color = "white") +
labs(fill = "Ingreso medio") +
scale_fill_viridis_c() +
theme_minimal()
region_plot
rm(list = ls())
modelo3 <- readRDS("ingreso/output/modelo_tree_edadcat.rds")
importancia3 <- xgb.importance(
model = modelo3
)
pi3 <- xgb.ggplot.importance(importancia3, rel_to_first = FALSE)
pi3
rm(list = ls())
set.seed(1998)
options(scipen=999)
# Encuesta quitamos ingreso, lp, li y fep
encuesta_mrp <- data.table(readRDS("ingreso/datos/encuesta_mrp.rds")) %>%
dplyr::select(-dam,-lp,-li,-fep) %>%
dplyr::filter(anoest != "98") |>
mutate_if(is.character, as.factor) %>%
dplyr::rename(
area_cat = area,
sexo_cat = sexo,
edad_cat = edad,
anoest_cat = anoest,
discapacidad_cat = discapacidad
)
summary(encuesta_mrp)
head(encuesta_mrp)
str(encuesta_mrp)
sparse_matrix <- sparse.model.matrix(ingreso ~ ., data = encuesta_mrp)[, -1]
y = encuesta_mrp[,2]
encuesta_mrp_m <- xgb.DMatrix(data = sparse_matrix,
label = as.matrix(sapply(y, as.numeric)))
pred <- predict(modelo3, newdata = encuesta_mrp_m)
modelo3 <- readRDS("ingreso/output/modelo_tree_edadcat.rds")
pred <- predict(modelo3, newdata = encuesta_mrp_m)
pred_encuesta <- ggplot(encuesta_mrp) +
geom_histogram(aes(x = ingreso,fill = "Observados"),
bins = 30,
color = "#C55A11",
alpha = 0.5,
linewidth = 0.2) +
geom_histogram(aes(x = pred, fill = "Predichos"),
bins = 30,
color = "#008194",
alpha = 0.3,
linewidth = 0.2) +
scale_fill_manual(values = c("#C55A11", "#008194")) +  labs(x = "Ingreso", y = " ", fill = "Valores") + xlim(0, 1000000) +
theme_classic() + geom_vline(xintercept = 121000, linetype = 2, col = "red", linewidth = 1)
pred_encuesta
pred_encuesta <- ggplot(encuesta_mrp) +
geom_histogram(
aes(x = ingreso, fill = "Observados"),
bins = 30,
color = "#C55A11",
alpha = 0.5,
linewidth = 0.2
) +
geom_histogram(
aes(x = pred, fill = "Predichos"),
bins = 30,
color = "#008194",
alpha = 0.3,
linewidth = 0.2
) +
scale_fill_manual(values = c("#C55A11", "#008194")) +
labs(x = "Ingreso", y = " ", fill = "Valores") + xlim(0, 1000000) +
theme_classic() +
geom_density(
aes(x = ingreso, fill = "Observados"),
bins = 30,
color = "#C55A11",
alpha = 0.5,
linewidth = 0.2
)
pred_encuesta <- ggplot(encuesta_mrp) +
geom_histogram(
aes(x = ingreso, fill = "Observados"),
bins = 30,
color = "#C55A11",
alpha = 0.5,
linewidth = 0.2
) +
geom_histogram(
aes(x = pred, fill = "Predichos"),
bins = 30,
color = "#008194",
alpha = 0.3,
linewidth = 0.2
) +
scale_fill_manual(values = c("#C55A11", "#008194")) +
labs(x = "Ingreso", y = " ", fill = "Valores") + xlim(0, 1000000) +
theme_classic() +
geom_density(
aes(x = ingreso, fill = "Observados"),
color = "#C55A11",
alpha = 0.5,
linewidth = 0.2
)
pred_encuesta
pred_encuesta <- ggplot(encuesta_mrp) +
geom_histogram(
aes(x = ingreso, fill = "Observados"),
bins = 30,
color = "#C55A11",
alpha = 0.5,
linewidth = 0.2
) +
geom_histogram(
aes(x = pred, fill = "Predichos"),
bins = 30,
color = "#008194",
alpha = 0.3,
linewidth = 0.2
) +
scale_fill_manual(values = c("#C55A11", "#008194")) +
labs(x = "Ingreso", y = " ", fill = "Valores") + xlim(0, 1000000) +
theme_classic() +
geom_density(
aes(x = ingreso, fill = "Observados"),
color = "#C55A11"
)
pred_encuesta
pred_encuesta <- ggplot(encuesta_mrp) +
geom_histogram(
aes(x = ingreso, fill = "Observados"),
bins = 30,
color = "#C55A11",
alpha = 0.5,
linewidth = 0.2
) +
geom_histogram(
aes(x = pred, fill = "Predichos"),
bins = 30,
color = "#008194",
alpha = 0.3,
linewidth = 0.2
) +
scale_fill_manual(values = c("#C55A11", "#008194")) +
labs(x = "Ingreso", y = " ", fill = "Valores") +
xlim(0, 1000000) +
theme_classic() +
geom_line(
aes(x = ingreso, fill = "Observados"),
color = "#C55A11"
)
pred_encuesta <- ggplot(encuesta_mrp) +
geom_histogram(
aes(x = ingreso, fill = "Observados"),
bins = 30,
color = "#C55A11",
alpha = 0.5,
linewidth = 0.2
) +
geom_histogram(
aes(x = pred, fill = "Predichos"),
bins = 30,
color = "#008194",
alpha = 0.3,
linewidth = 0.2
) +
scale_fill_manual(values = c("#C55A11", "#008194")) +
labs(x = "Ingreso", y = " ", fill = "Valores") +
xlim(0, 1000000) +
theme_classic() +
geom_line(
aes(x = ingreso),
color = "#C55A11"
)
pred_encuesta
pred_encuesta <- ggplot(encuesta_mrp) +
geom_histogram(
aes(x = ingreso, fill = "Observados"),
bins = 30,
color = "#C55A11",
alpha = 0.5,
linewidth = 0.2
) +
geom_histogram(
aes(x = pred, fill = "Predichos"),
bins = 30,
color = "#008194",
alpha = 0.3,
linewidth = 0.2
) +
scale_fill_manual(values = c("#C55A11", "#008194")) +
labs(x = "Ingreso", y = " ", fill = "Valores") +
xlim(0, 1000000) +
theme_classic() +
geom_line(
aes(x = ingreso, y = ..count..),
color = "#C55A11"
)
pred_encuesta
pred_encuesta <- ggplot(encuesta_mrp) +
geom_histogram(
aes(x = ingreso, fill = "Observados"),
bins = 30,
color = "#C55A11",
alpha = 0.5,
linewidth = 0.2
) +
geom_histogram(
aes(x = pred, fill = "Predichos"),
bins = 30,
color = "#008194",
alpha = 0.3,
linewidth = 0.2
) +
scale_fill_manual(values = c("#C55A11", "#008194")) +
labs(x = "Ingreso", y = " ", fill = "Valores") +
xlim(0, 1000000) +
theme_classic()
pred_encuesta
pred_encuesta <- ggplot(encuesta_mrp) +
geom_histogram(
aes(x = ingreso, fill = "Observados"),
bins = 30,
color = "#C55A11",
alpha = 0.5,
linewidth = 0.2
) +
geom_histogram(
aes(x = pred, fill = "Predichos"),
bins = 30,
color = "#008194",
alpha = 0.3,
linewidth = 0.2
) +
+
geom_density(
aes(x = ingreso, color = "Observados"),
size = 1,
linetype = "solid"
) +
geom_density(
aes(x = pred, color = "Predichos"),
size = 1,
linetype = "dashed"
) +
scale_fill_manual(values = c("#C55A11", "#008194")) +
labs(x = "Ingreso", y = " ", fill = "Valores") +
xlim(0, 1000000) +
theme_classic()
pred_encuesta <- ggplot(encuesta_mrp) +
geom_histogram(
aes(x = ingreso, fill = "Observados"),
bins = 30,
color = "#C55A11",
alpha = 0.5,
linewidth = 0.2
) +
geom_histogram(
aes(x = pred, fill = "Predichos"),
bins = 30,
color = "#008194",
alpha = 0.3,
linewidth = 0.2
) +
geom_density(
aes(x = ingreso, color = "Observados"),
size = 1,
linetype = "solid"
) +
geom_density(
aes(x = pred, color = "Predichos"),
size = 1,
linetype = "dashed"
) +
scale_fill_manual(values = c("#C55A11", "#008194")) +
labs(x = "Ingreso", y = " ", fill = "Valores") +
xlim(0, 1000000) +
theme_classic()
# geom_vline(
#   xintercept = 121000,
#   linetype = 2,
#   col = "red",
#   linewidth = 1
# )
pred_encuesta
ggplot(encuesta_mrp) +
geom_histogram(
aes(x = ingreso, fill = "Observados"),
bins = 30,
color = "#C55A11",
alpha = 0.5,
linewidth = 0.2
) +
geom_histogram(
aes(x = pred, fill = "Predichos"),
bins = 30,
color = "#008194",
alpha = 0.3,
linewidth = 0.2
) +
geom_density(
aes(x = ingreso),
size = 1,
linetype = "solid"
) +
geom_density(
aes(x = pred),
size = 1,
linetype = "dashed"
) +
scale_fill_manual(values = c("#C55A11", "#008194")) +
labs(x = "Ingreso", y = " ", fill = "Valores") +
xlim(0, 1000000) +
theme_classic()
# geom_vline(
#   xintercept = 121000,
#   linetype = 2,
#   col = "red",
#   linewidth = 1
# )
pred_encuesta <- ggplot(encuesta_mrp) +
geom_histogram(
aes(x = ingreso, fill = "Observados"),
bins = 30,
color = "#C55A11",
alpha = 0.5,
linewidth = 0.2
) +
geom_histogram(
aes(x = pred, fill = "Predichos"),
bins = 30,
color = "#008194",
alpha = 0.3,
linewidth = 0.2
) +
geom_density(
aes(x = ingreso, fill = "Observados"),
stat = "density",
size = 1,
linetype = "solid"
) +
geom_density(
aes(x = pred, fill = "Predichos"),
size = 1,
linetype = "dashed"
) +
scale_fill_manual(values = c("#C55A11", "#008194")) +
labs(x = "Ingreso", y = " ", fill = "Valores") +
xlim(0, 1000000) +
theme_classic()
pred_encuesta
pred_encuesta <- ggplot(encuesta_mrp) +
geom_histogram(
aes(x = ingreso, fill = "Observados"),
bins = 30,
color = "#C55A11",
alpha = 0.5,
linewidth = 0.2
) +
geom_histogram(
aes(x = pred, fill = "Predichos"),
bins = 30,
color = "#008194",
alpha = 0.3,
linewidth = 0.2
)  +
scale_fill_manual(values = c("#C55A11", "#008194")) +
labs(x = "Ingreso", y = " ", fill = "Valores") +
xlim(0, 1000000) +
theme_classic()
# geom_vline(
#   xintercept = 121000,
#   linetype = 2,
#   col = "red",
#   linewidth = 1
# )
pred_encuesta
