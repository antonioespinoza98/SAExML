ggplot(encuesta_mrp) +
geom_histogram(aes(x = ingreso,fill = "Observados"),
bins = 30,
color = "#C55A11",
alpha = 0.5,
size = 0.2) +
geom_histogram(aes(x = pred, fill = "Predichos"),
bins = 30,
color = "#008194",
alpha = 0.3,
size = 0.2) +
scale_fill_manual(values = c("#C55A11", "#008194")) +  labs(x = "Ingreso", y = " ", fill = "Valores") +
xlim(0, 3000000) +
theme_classic()
ggplot(encuesta_mrp) +
geom_histogram(aes(x = ingreso,fill = "Observados"),
bins = 30,
color = "#C55A11",
alpha = 0.5,
size = 0.2) +
geom_histogram(aes(x = pred, fill = "Predichos"),
bins = 30,
color = "#008194",
alpha = 0.3,
size = 0.2) +
scale_fill_manual(values = c("#C55A11", "#008194")) +  labs(x = "Ingreso", y = " ", fill = "Valores") +
xlim(0, 2500000) +
theme_classic()
pred_encuesta <- ggplot(encuesta_mrp) +
geom_histogram(aes(x = ingreso,fill = "Observados"),
bins = 30,
color = "#C55A11",
alpha = 0.5,
size = 0.2) +
geom_histogram(aes(x = pred, fill = "Predichos"),
bins = 30,
color = "#008194",
alpha = 0.3,
size = 0.2) +
scale_fill_manual(values = c("#C55A11", "#008194")) +  labs(x = "Ingreso", y = " ", fill = "Valores") +
xlim(0, 2500000) +
theme_classic()
ggsave(pred_encuesta, filename = "ingreso/output/encuesta.png")
rm(list = ls())
shp = read_sf("ingreso/output/regiones de mideplan_CR.shp")
shp = read_sf("ingreso/datos/regiones de mideplan_CR.shp")
read_sf("CRI/2021/ShapedeptoCRI/regiones de mideplan_CR.shp")
shp = read_sf("C:/Users/mespinoza/Documents/CRI/2021/ShapeDeptoCRI")
shp = read_sf("ingreso/data/ShapeDeptoCRI")
shp = read_sf("ingreso/datos/ShapeDeptoCRI")
shp = read_sf("ingreso/datos/ShapeDeptoCRI.shp")
glimpse(shp)
ggplot(
data = shp) +
geom_sf(color = "white", fill = "#365486") +
theme_minimal()
regiones_simplificadas <- ms_simplify(
input = regiones,
keep = 0.05,
keep_shapes = FALSE
)
regiones_simplificadas <- ms_simplify(
input = shp,
keep = 0.05,
keep_shapes = FALSE
)
# eliminar la isla del coco
regiones_simplificadas <- ms_filter_islands(
input = regiones_simplificadas,
min_area = 24000000
)
write_sf(
obj = regiones_simplificadas, dsn = "MIDEPLAN_cr.geojson")
mideplan <- st_read("MIDEPLAN_cr.geojson", quiet = TRUE)
ggplot(
data = mideplan
) +
geom_sf(color = "white", fill = "#365486") +
theme_minimal()
censo_mrp <- censo_mrp <- readRDS("ingreso/datos/censo_mrp1.rds")
pred <- readRDS("ingreso/output/pred.rds")
censo_mrp$pred_ingreso <- pred
ingreso_region <- censo_mrp %>%
group_by(dam) %>%
summarise(
ingreso_medio = mean(pred_ingreso)
)
View(ingreso_region)
View(mideplan)
View(shp)
View(regiones_simplificadas)
censo_mrp <- censo_mrp <- readRDS("ingreso/datos/censo_mrp1.rds") %>%
mutate(
dam = recode(codigo,
"01" = 1,
"02" = 2,
"03" = 3,
"04" = 4,
"05" = 5,
"06" = 6))
censo_mrp <- censo_mrp <- readRDS("ingreso/datos/censo_mrp1.rds") %>%
mutate(
codigo = recode(dam,
"01" = 1,
"02" = 2,
"03" = 3,
"04" = 4,
"05" = 5,
"06" = 6))
pred <- readRDS("ingreso/output/pred.rds")
censo_mrp$pred_ingreso <- pred
ingreso_region <- censo_mrp %>%
group_by(codigo) %>%
summarise(
ingreso_medio = mean(pred_ingreso)
)
View(ingreso_region)
saveRDS(ingreso_region, "ingreso/output/ingreso_region.rds")
mapping <- left_join(
x = mideplan,
y = ingreso_region,
by = join_by(codigo == codigo)
)
View(mapping)
View(ingreso_region)
mapa_plot <- ggplot(
data = mapping,
mapping = aes(
fill = ingreso_medio
)
) +
geom_sf(color = "white") +
labs(fill = "Ingreso medio") +
scale_fill_viridis_c() +
theme_minimal()
rm(mapa_plot)
ggplot(
data = mapping,
mapping = aes(
fill = ingreso_medio
)
) +
geom_sf(color = "white") +
labs(fill = "Ingreso medio") +
scale_fill_viridis_c() +
theme_minimal()
region_plot <- ggplot(
data = mapping,
mapping = aes(
fill = ingreso_medio
)
) +
geom_sf(color = "white") +
labs(fill = "Ingreso medio") +
scale_fill_viridis_c() +
theme_minimal()
ggsave(region_plot, filename = "ingreso/output/mapa_mideplan.png")
rm(list = ls())
encuesta_mrp <- readRDS("ingreso/datos/encuesta_mrp1.rds")
diseno <- encuesta_mrp %>% group_by(dam) %>%
as_survey_design(weights = fep)
media_est_srvyr <- diseno %>%
group_by(dam) %>%
summarise(media_ingreso = mean(ingreso))
censo_mrp <- censo_mrp <- readRDS("ingreso/datos/censo_mrp1.rds")
pred <- readRDS("ingreso/output/pred.rds")
censo_mrp$pred_ingreso <- pred
ingreso_dam <- censo_mrp %>%
group_by(dam) %>%
summarise(
media_ingreso = mean(pred_ingreso)
)
mapping <- rbind(media_est_srvyr, ingreso_dam)
estim <- c(rep("Directo", 6), rep("XGBoost", 6))
mapping <- cbind(mapping, estim)
mapping %>%
ggplot(
aes(x = dam,
y = media_ingreso,
col = estim)
) + geom_point() + theme_classic()
censo_mrp %>%
group_by(dam) %>%
summarise(
n = n()
)
mapping %>%
ggplot(
aes(x = dam,
y = media_ingreso,
col = estim)
) + geom_point() + theme_classic() +
scale_fill_manual(values = c("#008194","#C55A11")) +
labs(x = "Dam", y = "Ingreso medio", fill = "Modelo")
mapping %>%
ggplot(
aes(x = dam,
y = media_ingreso,
col = estim)
) + geom_point() + theme_classic() +
scale_color_manual(values = c("#008194","#C55A11")) +
labs(x = "Dam", y = "Ingreso medio", fill = "Modelo")
mapping %>%
ggplot(
aes(x = dam,
y = media_ingreso,
col = estim)
) + geom_point() + theme_classic() +
scale_color_manual(values = c("red","green")) +
labs(x = "Dam", y = "Ingreso medio", fill = "Modelo")
mapping %>%
ggplot(
aes(x = dam,
y = media_ingreso,
col = estim)
) + geom_point(size = 1) + theme_classic() +
scale_color_manual(values = c("red","green")) +
labs(x = "Dam", y = "Ingreso medio", fill = "Modelo")
mapping %>%
ggplot(
aes(x = dam,
y = media_ingreso,
col = estim)
) + geom_point(size = 2) + theme_classic() +
scale_color_manual(values = c("red","green")) +
labs(x = "Dam", y = "Ingreso medio", fill = "Modelo")
mapping %>%
ggplot(
aes(x = dam,
y = media_ingreso,
col = estim)
) + geom_point(size = 2) + theme_minimal() +
scale_color_manual(values = c("red","green")) +
labs(x = "Dam", y = "Ingreso medio", fill = "Modelo")
plot_validacion <- mapping %>%
ggplot(
aes(x = dam,
y = media_ingreso,
col = estim)
) + geom_point(size = 2) + theme_minimal() +
scale_color_manual(values = c("red","green")) +
labs(x = "Dam", y = "Ingreso medio", fill = "Modelo")
ggsave(plot_validacion, filename = "ingreso/output/validacion.png")
shp = read_sf("ingreso/datos/mideplan_CR.shp")
x <- c('tidyverse','survey','srvyr')
lapply(x, require, character.only = TRUE)
encuesta_mrp <- readRDS("ingreso/datos/encuesta_mrp1.rds") %>%
select(
# -X2016_crops.coverfraction, -X2016_urban.coverfraction,
#      -X2016_gHM, -accessibility, -accessibility_walking_only,
-area1, -sexo2,-edad2,-edad3, -edad4,-edad5,-anoest2,
-anoest3, -anoest4, -discapacidad1,-etnia1,-lp,-li,-pobreza) %>%
mutate_if(is.character, as.factor) %>%
mutate(dam = as.factor(dam))
diseno <- encuesta_mrp  %>%
as_survey_design(weights = ~fep)
diseno <- encuesta_mrp  %>%
as_survey_design(weights = fep)
svyby(
ingreso,
dam,
diseno,
svytotal
)
svyby(
ingreso,
by = dam,
diseno,
svytotal
)
svyby(
ingreso,
by = dam,
design = diseno,
svytotal
)
diseno
svyby(
ingreso,
by = "dam",
design = diseno,
svytotal
)
svyby(
x = "ingreso",
by = "dam",
design = diseno,
svytotal
)
svyby(
x = ingreso,
by = "dam",
design = diseno,
svytotal
)
svyby(
formula = ingreso,
by = "dam",
design = diseno,
svytotal
)
svyby(
formula = "ingreso",
by = "dam",
design = diseno,
svytotal
)
svyby(
ingreso,
by = dam,
design = diseno,
svytotal
)
svyby(
~ingreso,
by = ~dam,
design = diseno,
svytotal
)
options(scipen = 999)
svyby(
~ingreso,
by = ~dam,
design = diseno,
svytotal
)
svyby(
~ingreso,
by = ~dam,
design = diseno,
svymean
)
media_est_srvyr <- svyby(
~ingreso,
by = ~dam,
design = diseno,
svymean
)
censo_mrp <- censo_mrp <- readRDS("ingreso/datos/censo_mrp1.rds") %>%
mutate(
region = recode(dam,
"01" = "Central",
"02" = "Chorotega",
"03" = "Pacífico Central",
"04" = "Brunca",
"05" = "Huetar Caribe",
"06" = "Huetar Norte")) %>%
mutate(region = as.factor(region))
censo_mrp <- censo_mrp <- readRDS("ingreso/datos/censo_mrp1.rds") %>%
mutate(
region = recode(dam,
"01" = "Central",
"02" = "Chorotega",
"03" = "Pacífico Central",
"04" = "Brunca",
"05" = "Huetar Caribe",
"06" = "Huetar Norte")) %>%
mutate(region = as.factor(region))
pred <- readRDS("ingreso/output/pred.rds")
censo_mrp$pred_ingreso <- pred
ingreso_dam <- censo_mrp %>%
group_by(region) %>%
summarise(
media_ingreso = mean(pred_ingreso)
)
colnames(ingreso_dam) <- c("dam", "ingreso")
media_est_srvyr[,-3]
mapping <- rbind(media_est_srvyr[,-3], ingreso_dam)
estim <- c(rep("Directo", 6), rep("XGBoost", 6))
mapping <- cbind(mapping, estim)
mapping %>%
ggplot(
aes(x = Domain,
y = Direct,
col = estim)
) + geom_point(size = 2) + theme_minimal() +
scale_color_manual(values = c("red","green")) +
labs(x = "Dam", y = "Ingreso medio", fill = "Modelo")
mapping
mapping %>%
ggplot(
aes(x = dam,
y = ingreso,
col = estim)
) + geom_point(size = 2) + theme_minimal() +
scale_color_manual(values = c("red","green")) +
labs(x = "Dam", y = "Ingreso medio", fill = "Modelo")
censo_mrp <- censo_mrp <- readRDS("ingreso/datos/censo_mrp1.rds") %>%
#     mutate(
# region = recode(dam,
#              "01" = "Central",
#              "02" = "Chorotega",
#              "03" = "Pacífico Central",
#              "04" = "Brunca",
#              "05" = "Huetar Caribe",
#              "06" = "Huetar Norte")) %>%
mutate(region = as.factor(region))
censo_mrp <- censo_mrp <- readRDS("ingreso/datos/censo_mrp1.rds")
pred <- readRDS("ingreso/output/pred.rds")
censo_mrp$pred_ingreso <- pred
ingreso_dam <- censo_mrp %>%
group_by(region) %>%
summarise(
media_ingreso = mean(pred_ingreso)
)
ingreso_dam <- censo_mrp %>%
group_by(dam) %>%
summarise(
media_ingreso = mean(pred_ingreso)
)
ingreso_dam <- censo_mrp %>%
group_by(dam) %>%
summarise(
ingreso = mean(pred_ingreso)
)
mapping <- rbind(media_est_srvyr[,-3], ingreso_dam)
estim <- c(rep("Directo", 6), rep("XGBoost", 6))
mapping <- cbind(mapping, estim)
mapping %>%
ggplot(
aes(x = dam,
y = ingreso,
col = estim)
) + geom_point(size = 2) + theme_minimal() +
scale_color_manual(values = c("red","green")) +
labs(x = "Dam", y = "Ingreso medio", fill = "Modelo")
rm(list = ls())
encuesta_mrp <- readRDS("ingreso/datos/encuesta_mrp1.rds") %>%
select(
# -X2016_crops.coverfraction, -X2016_urban.coverfraction,
#      -X2016_gHM, -accessibility, -accessibility_walking_only,
-area1, -sexo2,-edad2,-edad3, -edad4,-edad5,-anoest2,
-anoest3, -anoest4, -discapacidad1,-etnia1,-lp,-li,-pobreza) %>%
mutate(
region = recode(dam,
"01" = "Central",
"02" = "Chorotega",
"03" = "Pacífico Central",
"04" = "Brunca",
"05" = "Huetar Caribe",
"06" = "Huetar Norte")) %>%
mutate(region = as.factor(region)) %>%
mutate_if(is.character, as.factor) %>%
mutate(dam = as.factor(dam))
diseno <- encuesta_mrp  %>%
as_survey_design(weights = fep)
media_est_srvyr <- svyby(
~ingreso,
by = ~region,
design = diseno,
svymean
)
censo_mrp <- censo_mrp <- readRDS("ingreso/datos/censo_mrp1.rds") %>%
mutate(
region = recode(dam,
"01" = "Central",
"02" = "Chorotega",
"03" = "Pacífico Central",
"04" = "Brunca",
"05" = "Huetar Caribe",
"06" = "Huetar Norte")) %>%
mutate(region = as.factor(region))
pred <- readRDS("ingreso/output/pred.rds")
censo_mrp$pred_ingreso <- pred
ingreso_dam <- censo_mrp %>%
group_by(dam) %>%
summarise(
ingreso = mean(pred_ingreso)
)
mapping <- rbind(media_est_srvyr[,-3], ingreso_dam)
ingreso_dam <- censo_mrp %>%
group_by(region) %>%
summarise(
ingreso = mean(pred_ingreso)
)
mapping <- rbind(media_est_srvyr[,-3], ingreso_dam)
estim <- c(rep("Directo", 6), rep("XGBoost", 6))
mapping <- cbind(mapping, estim)
plot_validacion <- mapping %>%
ggplot(
aes(x = dam,
y = ingreso,
col = estim)
) + geom_point(size = 2) + theme_minimal() +
scale_color_manual(values = c("red","green")) +
labs(x = "Dam", y = "Ingreso medio", fill = "Modelo")
plot_validacion
plot_validacion <- mapping %>%
ggplot(
aes(x = region,
y = ingreso,
col = estim)
) + geom_point(size = 2) + theme_minimal() +
scale_color_manual(values = c("red","green")) +
labs(x = "Dam", y = "Ingreso medio", fill = "Modelo")
plot_validacion
censo_mrp %>%
group_by(region) %>%
summarise(
media_ingreso = mean(pred_ingreso)
)
encuesta_mrp %>%
group_by(dam) %>%
summarise(
media_ingreso = mean(ingreso)
)
media_est_srvyr
encuesta_mrp %>%
group_by(region) %>%
summarise(
media_ingreso = mean(ingreso)
)
