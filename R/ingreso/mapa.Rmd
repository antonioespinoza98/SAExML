---
output: html_document
editor_options: 
  chunk_output_type: console
---

Autor: Marco Espinoza
CEPAL - División de Estadística
fecha: mayo - 2024



# Mapa de ingreso medio para Costa Rica

```{r}
rm(list = ls())
```


# Librerias

```{r}
x <- c('tidyverse','sf','httr2','ows4R','rmapshaper','janitor')
lapply(x, require, character.only = TRUE)
```

# Extracción de información geoespacial

Nota: Este código es ilustrativo. Ya que el archivo final está guardado en la carpeta *output* con el nombre de: `cantones_cr.geojson` 

Para más información, revisar la siguiente [página](https://www.snitcr.go.cr/ico_servicios_ogc_info?k=bm9kbzo6OTM=&nombre=IGN%20Cartograf%C3%ADa%201:5mil%20CO)

# Mapa para los cantones de Costa Rica

```{r}
cantones <- st_read("ingreso/output/cantones_ajustado_cr.geojson", quiet = TRUE)
```

Leemos la base resumen del ingreso cantonal

```{r}
ingreso_cantonal <- readRDS("ingreso/output/ingreso_cantonal.rds")
```

Unimos las dos bases de datos

```{r}
mapa <- left_join(
  x = cantones,
  y = ingreso_cantonal,
  by = join_by(canton == canton)
)

glimpse(mapa)
```

```{r}
mapa_plot <- ggplot(
  data = mapa,
  mapping = aes(
    fill = ingreso_medio
  )
) +
  geom_sf(color = "white") +
  labs(fill = "Ingreso medio") +
  scale_fill_viridis_c() +
  theme_minimal()
```

```{r}
ggsave(mapa_plot, filename = "ingreso/output/mapa_cantonal.png")
```

# Mapa para las regiones de planificación

```{r}
rm(list = ls())
```

```{r}
regiones <- st_read("ingreso/output/regiones_cr.geojson")
```

```{r}
ingreso_region <- readRDS("ingreso/output/ingreso_region.rds")
```

```{r}
mapping <- left_join(
  x = regiones,
  y = ingreso_region,
  by = join_by(region == region)
)
```

```{r}
region_plot <- ggplot(
  data = mapping,
  mapping = aes(
    fill = ingreso_medio
  )
) +
  geom_sf(color = "white") +
  labs(fill = "Ingreso medio") +
  scale_fill_viridis_c() +
  theme_minimal()
```

```{r}
ggsave(region_plot, filename = "ingreso/output/mapa_mideplan.png")
```

# Mapa distrital

```{r}
distritos <- st_read("ingreso/output/distritos_cr.geojson") %>% 
  janitor::clean_names() 
```

```{r}
ingreso_dist <- readRDS("ingreso/output/ingreso_distrital.rds") %>% 
  mutate(distrito = as.numeric(distrito))
```

```{r}
mapping <- left_join(
  x = distritos,
  y = ingreso_dist,
  by = join_by(codigo_dta == distrito)
)
```

```{r}
ggplot(
  data = mapping,
  mapping = aes(
    fill = media_ingreso
  )
) +
  geom_sf(color = "white") +
  labs(fill = "Ingreso medio") +
  scale_fill_viridis_c() +
  theme_minimal()
```





